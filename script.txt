@echo off

REM password policy
net accounts /uniquepw:5
net accounts /maxpwage:60
net accounts /minpwage:10
net accounts /minpwlen:8
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v "PasswordComplexity" /t REG_DWORD /d 1 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v "StoreLmHash" /t REG_DWORD /d 0 /f

REM enables smartscreen
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\AppHost" /v "EnableWebContentEvaluation" /t REG_DWORD /d 1 /f

REM wifi sense
reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\wcmsvc\wifinetworkmanager\config" /v "AutoConnectAllowedOEM" /t 	REG_DWORD /d 0 /f

REM lockout policy
net accounts /lockoutthreshold:5

REM audit policy
auditpol /set /category:* /success:enable
auditpol /set /category:* /failure:enable

REM user rights
set remove="Backup Operators" "Everyone" "Power Users" "Users" "SERVICE" "NETWORK SERVICE" "LOCAL SERVICE" "Remote Desktop Users" "ANONOYMOUS LOGON" "Guest" "Performance Log Users" "Administrators"
for %%a in (%remove%) do (
  ntrights -r SeTrustedCredManAccessPrivilege -u %%a
  ntrights -r SeTcbPrivilege -u %%a
  ntrights -r SeCreateTokenPrivilege -u %%a
  ntrights -r SeCreatePermanentPrivilege -u %%a
  ntrights -r SeEnableDelegationPrivilege -u %%a
  ntrights -r SeLockMemoryPrivilege -u %%a
  ntrights -r SeServiceLogonRight -u %%a
  ntrights -r SeRelabelPrivilege -u %%a
)
set remove="Backup Operators" "Everyone" "Power Users" "Users" "SERVICE" "NETWORK SERVICE" "LOCAL SERVICE" "Remote Desktop Users" "ANONOYMOUS LOGON" "Guest" "Performance Log Users"
for %%a in (%remove%) do (
  ntrights -r SeNetworkLogonRight -u %%a
  ntrights -r SeBackupPrivilege -u %%a
  ntrights -r SeCreatePagefilePrivilege -u %%a
  ntrights -r SeCreateSymbolicLinkPrivilege -u %%a
  ntrights -r SeDebugPrivilege -u %%a
  ntrights -r SeRemoteShutdownPrivilege -u %%a
  ntrights -r SeIncreaseBasePriorityPrivilege -u %%a
  ntrights -r SeLoadDriverPrivilege -u %%a
  ntrights -r SeBatchLogonRight -u %%a
  ntrights -r SeSecurityPrivilege -u %%a
  ntrights -r SeSystemEnvironmentPrivilege -u %%a
  ntrights -r SeManageVolumePrivilege -u %%a
  ntrights -r SeProfileSingleProcessPrivilege -u %%a
  ntrights -r SeSystemProfilePrivilege -u %%a
  ntrights -r SeRestorePrivilege -u %%a
  ntrights -r SeTakeOwnershipPrivilege -u %%a
)
set remove="Backup Operators" "Everyone" "Local account" "Power Users" "Users" "SERVICE" "Remote Desktop Users" "ANONOYMOUS LOGON" "Guest" "Performance Log Users"
for %%a in (%remove%) do (
  ntrights -r SeIncreaseQuotaPrivilege -u %%a
)
set remove="Backup Operators" "Everyone" "Power Users" "SERVICE" "NETWORK SERVICE" "LOCAL SERVICE" "Remote Desktop Users" "ANONOYMOUS LOGON" "Guest" "Performance Log Users"
for %%a in (%remove%) do (
  ntrights -r SeInteractiveLogonRight -u %%a
  ntrights -r SeShutdownPrivilege -u %%a
)
set remove="Backup Operators" "Everyone" "Power Users" "Users" "SERVICE" "NETWORK SERVICE" "LOCAL SERVICE" "ANONOYMOUS LOGON" "Guest" "Performance Log Users"
for %%a in (%remove%) do (
  ntrights -r SeRemoteInteractiveLogonRight -u %%a
)
set remove="Backup Operators" "Everyone" "Power Users" "Users" "SERVICE" "NETWORK SERVICE" "Remote Desktop Users" "ANONOYMOUS LOGON" "Guest" "Performance Log Users"
for %%a in (%remove%) do (
  ntrights -r SeSystemtimePrivilege -u %%a
)
set remove="Backup Operators" "Everyone" "Power Users" "SERVICE" "NETWORK SERVICE" "Remote Desktop Users" "ANONOYMOUS LOGON" "Guest" "Performance Log Users"
for %%a in (%remove%) do (
  ntrights -r SeTimeZonePrivilege -u %%a
)
set remove="Backup Operators" "Everyone" "Power Users" "Users" "Remote Desktop Users" "ANONOYMOUS LOGON" "Guest" "Performance Log Users"
for %%a in (%remove%) do (
  ntrights -r SeCreateGlobalPrivilege -u %%a
  ntrights -r SeImpersonatePrivilege -u %%a
)
set remove="Backup Operators" "Everyone" "Power Users" "Users" "SERVICE" "NETWORK SERVICE" "LOCAL SERVICE" "Remote Desktop Users" "ANONOYMOUS LOGON" "Performance Log Users" "Administrators"
for %%a in (%remove%) do (
  ntrights -r SeDenyNetworkLogonRight -u %%a
  ntrights -r SeDenyBatchLogonRight -u %%a
  ntrights -r SeDenyServiceLogonRight -u %%a
  ntrights -r SeDenyInteractiveLogonRight -u %%a
  ntrights -r SeDenyRemoteInteractiveLogonRight -u %%a
)
set remove="Backup Operators" "Everyone" "Power Users" "Users" "SERVICE" "Remote Desktop Users" "ANONOYMOUS LOGON" "Guest" "Performance Log Users" "Administrators"
for %%a in (%remove%) do (
  ntrights -r SeAuditPrivilege -u %%a
  ntrights -r SeAssignPrimaryTokenPrivilege -u %%a
)

set add="Administrators"
for %%a in (%add%) do (
  ntrights +r SeNetworkLogonRight -u %%a
  ntrights +r SeBackupPrivilege -u %%a
  ntrights +r SeCreatePagefilePrivilege -u %%a
  ntrights +r SeCreateSymbolicLinkPrivilege -u %%a
  ntrights +r SeDebugPrivilege -u %%a
  ntrights +r SeRemoteShutdownPrivilege -u %%a
  ntrights +r SeIncreaseBasePriorityPrivilege -u %%a
  ntrights +r SeLoadDriverPrivilege -u %%a
  ntrights +r SeBatchLogonRight -u %%a
  ntrights +r SeSecurityPrivilege -u %%a
  ntrights +r SeTakeOwnershipPrivilege -u %%a
  ntrights +r SeRestorePrivilege -u %%a
  ntrights +r SeSystemProfilePrivilege -u %%a
  ntrights +r SeProfileSingleProcessPrivilege -u %%a
  ntrights +r SeManageVolumePrivilege -u %%a
  ntrights +r SeSystemEnvironmentPrivilege -u %%a
)
set add="NETWORK SERVICE" "LOCAL SERVICE" "Administrators"
for %%a in (%add%) do (
  ntrights +r SeIncreaseQuotaPrivilege -u %%a
)
set add="Users" "Administrators"
for %%a in (%add%) do (
  ntrights +r SeInteractiveLogonRight -u %%a
  ntrights +r SeShutdownPrivilege -u %%a
)
set add="Remote Desktop Users" "Administrators"
for %%a in (%add%) do (
  ntrights +r SeRemoteInteractiveLogonRight -u %%a
)
set add="LOCAL SERVICE" "Administrators"
for %%a in (%add%) do (
  ntrights +r SeSystemtimePrivilege -u %%a
)
set add="Users" "LOCAL SERVICE" "Administrators"
for %%a in (%add%) do (
  ntrights +r SeTimeZonePrivilege -u %%a
)
set add="SERVICE" "NETWORK SERVICE" "LOCAL SERVICE" "Administrators"
for %%a in (%add%) do (
  ntrights +r SeCreateGlobalPrivilege -u %%a
  ntrights +r SeImpersonatePrivilege -u %%a
)
set add="Guest"
for %%a in (%add%) do (
  ntrights +r SeDenyNetworkLogonRight -u %%a
  ntrights +r SeDenyBatchLogonRight -u %%a
  ntrights +r SeDenyServiceLogonRight -u %%a
  ntrights +r SeDenyInteractiveLogonRight -u %%a
  ntrights +r SeDenyRemoteInteractiveLogonRight -u %%a
)
set add="NETWORK SERVICE" "LOCAL SERVICE"
for %%a in (%add%) do (
  ntrights +r SeAuditPrivilege -u %%a
  ntrights +r SeAssignPrimaryTokenPrivilege -u %%a
)

REM enable firewall
netsh advfirewall set allprofiles state on

REM security options
net user administrator /active:no
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v NoConnectedUser /t REG_DWORD /d 3 /f
net user guest /active:no
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v LimitBlankPasswordUse /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v AuditBaseObjects /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v FullPrivilegeAuditing /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v SCENoApplyLegacyAuditPolicy /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v CrashOnAuditFail /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Ole" /v MachineAccessRestriction /t REG_SZ /d "System\CurrentControlSet\Control\Lsa\SecureBindings" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Ole" /v MachineLaunchRestriction /t REG_SZ /d "System\CurrentControlSet\Control\Lsa\SecureBindings" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v UndockWithoutLogon /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AllocateDASD /t REG_MULTI_SZ /d "Administrators\0Interactive Users" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Printers" /v PreventUserInstallPrinterDrivers /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters" /v RequireSignOrSeal /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters" /v SealSecureChannel /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters" /v SignSecureChannel /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters" /v DisablePasswordChange /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters" /v MaximumPasswordAge /t REG_DWORD /d 30 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v RequireStrongKey /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v DontDisplayLockedUserId /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v DontDisplayLastUserName /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v DisableCAD /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v MachineAccountLockoutThreshold /t REG_DWORD /d 10 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v InactivityTimeoutSecs /t REG_DWORD /d 900 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v CachedLogonsCount /t REG_SZ /d 4 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v PasswordExpiryWarning /t REG_DWORD /d 14 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v ForceUnlockLogon /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v SCRemoveOption /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v SCRemoveOption /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters" /v RequireSecuritySignature /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters" /v EnableSecuritySignature /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters" /v EnablePlainTextPassword /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters" /v autodisconnect /t REG_DWORD /d 15 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters" /v RequireSecuritySignature /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters" /v EnableSecuritySignature /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters" /v EnableForcedLogoff /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters" /v LdapServerIntegrity /t REG_DWORD /d 2 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v RestrictAnonymous /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v RestrictAnonymousSAM /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v RestrictAnonymous /t REG_DWORD /d 2 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v DisableDomainCreds /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v RestrictNullSessAccess /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters" /v NullSessionPipes /t REG_MULTI_SZ /d "" /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurePipeServers\Winreg" /v AllowedPaths /t REG_MULTI_SZ /d "" /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurePipeServers\Winreg" /v AllowedExactPaths /t REG_MULTI_SZ /d "" /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters" /v RestrictNullSessAccess /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters" /v NullSessionShares /t REG_MULTI_SZ /d "" /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareServer /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareWks /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v UseMachineId /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v RestrictAnonymous /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\pku2u" /v AllowOnlineID /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Kerberos\Parameters" /v SupportedEncryptionTypes /t REG_DWORD /d 2147483647 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v NoLMHash /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v InactivityTimeoutSecs /t REG_DWORD /d 900 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v LmCompatibilityLevel /t REG_DWORD /d 5 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LDAP" /v LDAPClientIntegrity /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0" /v NTLMMinClientSec /t REG_DWORD /d 537395200 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0" /v NTLMMinServerSec /t REG_DWORD /d 537395200 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0" /v RestrictReceivingNTLMTraffic /t REG_DWORD /d 2 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0" /v RestrictSendingNTLMTraffic /t REG_DWORD /d 2 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0" /v RestrictSendingNTLMTrafficToRemoteServers /t REG_DWORD /d 2 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Setup\RecoveryConsole" /v SetCommand /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Setup\RecoveryConsole" /v SecurityLevel /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v ShutdownWithoutLogon /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" /v ClearPageFileAtShutdown /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\FipsAlgorithmPolicy" /v Enabled /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\kernel" /v obcaseinsensitive /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v UseLUA /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\SubSystems" /v Optional /t REG_SZ /d "" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Safer\CodeIdentifiers" /v AuthenticodeEnabled /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v FilterAdministratorToken /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v EnableUIADesktopToggle /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v ConsentPromptBehaviorAdmin /t REG_DWORD /d 2 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v ConsentPromptBehaviorUser /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v EnableInstallerDetection /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v ValidateAdminCodeSignatures /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v EnableSecureUIAPaths /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v EnableLUA /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v PromptOnSecureDesktop /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v EnableVirtualization /t REG_DWORD /d 1 /f

pause
